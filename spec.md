# Web Design Rokuro — 機能仕様書

このツールは、デザイナーが「スクロール体験におけるレイアウトの緩急・リズム」を
身体的に描画して外在化するためのプロトタイプである。

主な特徴は以下：
- 自動スクロール中のキャンバス上に、横長矩形ブラシでペイントする
- ペイントは真っ黒（#000000）で、不透明度100%固定
- 全塗り（画面幅いっぱいの帯）を描くモードがある（Shiftキー対応）
- **ループ記録**：キャンバス末尾に達すると冒頭に戻り、記録が継続される
- **ループ可視化**：末尾付近で描画しても即座に確認できる（画面下部に冒頭部分を表示）
- キャンバス長さをユーザーが設定可能（2000px〜10000px、デフォルト5000px）
- 書き出しは白地に描画痕跡のみのPNG（設定したキャンバス長さ全体）
- ミニマルでソリッドなデザイン（無彩色、シャドウなし、角丸最小限）
- PCでのキーボードショートカット：Spaceで記録開始/停止、Shiftで全塗りモード

---

## 1. 表示構造

### ● キャンバス（中央）
- 画面中央に横長のフレームとして表示される（最大幅1200px、17:8のアスペクト比）
- 白地のキャンバスが **上 → 下** に自動スクロールする
- **キャンバス長さはユーザーが設定可能**（2000px〜10000px、記録中は変更不可）
- **ループ記録**：キャンバス末尾に達すると自動的に冒頭（0px）に戻り、記録が継続される
- **ループ可視化**：キャンバス末尾付近では、画面下部にキャンバス冒頭部分が表示される（シームレスな描画体験を実現）
- スクロール速度は設定画面から変更（記録中は変更不可）
- ブラシプレビュー：マウスカーソルがキャンバス上にあるとき、薄いグレーの1px境界線でブラシ形状が表示される

### ● キャンバス周辺の固定UI

- **左上**：
  - アプリ名表示「Web Design Rokuro」（控えめな16pxグレー文字）
  - **キャンバス長さ設定入力フォーム**：
    - ラベル：「Canvas Length (px)」
    - 入力フィールド：数値入力（2000〜10000の範囲）
    - 記録中は入力不可（disabled状態）
    - デフォルト値：5000px

- **右上**：
  - `Start Recording` / `Stop Recording`（状態で切り替わる、黒背景の時は記録中）
  - **スペースキーでも記録の開始/停止が可能**

- **上中央**：
  - **記録中のみ表示**: 現在のスクロール位置（px）を表示
  - 表示形式：「[現在のオフセット]px / [キャンバス長さ]px (Loop [周回数])」
  - 例：「2450px / 5000px (Loop 1)」

- **左下**：
  - `Clear`（キャンバス全消去）
  - `Export`（PNG書き出し）

- **中央下**：
  - `Full Paint Mode (Hold Shift)`
    - ボタンを押し続けている間、または**Shiftキーを押している間**、Full Paint Modeになる
    - キャンバスをタッチすると、その位置から画面幅いっぱいの帯が連続的に描画される
    - カーソルが動かなくても、スクロールに応じて描画が続く
    - アクティブ時はボタンが黒背景に変化（視覚的フィードバック）

- **右下**：
  - 設定ボタン（⚙アイコン、48px角、矩形）

---

## 2. 設定モーダル（中央表示）

設定ボタンをクリックすると中央にモーダルが表示される。
このモーダルは **「描く前の準備」「ツール設定」だけを扱う」**。

**設定項目**：
- **ブラシサイズ**（Small: 10px / Medium: 205px / Large: 400px）
- **スクロール速度**（Slow: 1px/frame / Medium: 2px/frame / Fast: 4px/frame）

**仕様**：
- 記録中は設定ボタンが無効化され、モーダルは開けない
- 不透明度は100%固定（設定項目なし）
- モーダルは白背景、1px黒ボーダー、角丸2px
- アクティブな選択肢は黒背景+白文字

---

## 3. 描画仕様

### ● ブラシ
- **形状**：横長矩形（8:1のアスペクト比）
- **塗り色**：真っ黒（#000000）
- **不透明度**：100%固定
- **サイズ**：Small(10px) / Medium(205px) / Large(400px)から選択
- 重ね塗りしても濃さは変わらない（常に真っ黒）
- ブラシサイズ切替は設定モーダルで行う（記録中は変更不可）

### ● 描画動作
- マウス/タッチで触れた地点に矩形ブラシで塗る
- 自動スクロール中でも操作可能
- **タッチし続けている間、連続的に描画される**（カーソルが動かなくてもスクロールに応じて垂直線が描かれる）
- **ループ記録**：キャンバス末尾到達時に自動的に冒頭に戻り、記録継続（2周目以降は既存の描画に重ねて描画）
- **シームレスな描画**：キャンバス末尾付近で描画しても、ループ可視化により即座に描画が確認できる
- 描画中、設定変更は不可（誤操作防止）

### ● Full Paint Mode（重要）
- 中央下のボタンを押し続ける、または**Shiftキーを押している間**、Full Paint Modeになる
- キャンバスをタッチした瞬間から、その位置で画面幅いっぱいの帯が連続的に描画される
- **カーソルが動かなくても、スクロールに応じて描画が続く**
- カーソルを動かすとY位置が更新され、新しい位置で描画が続く
- Shiftキー対応により、ボタンにフォーカスがなくても使用可能

---

## 4. 記録・再生

- `Start Recording` → スクロールが動き出し、描画可能になる
  - **スペースキーでも開始可能**
- `Stop Recording` → スクロール停止、描画停止
  - **スペースキーでも停止可能**
- **ループ記録**：キャンバス末尾（設定した長さ）に到達すると自動的に冒頭（0px）に戻り、記録が継続される
  - 1周 = キャンバス冒頭（0px）から末尾（設定長さ）まで
  - 2周目以降は既存の描画に重ねて描画される
  - **ループ可視化**：末尾付近（残り距離が画面高さより短い場合）では、画面下部にキャンバス冒頭部分が自動的に表示される
    - これにより、キャンバス末尾で描画しても即座に確認でき、シームレスな描画体験が実現される
- **全消去（Clear）**：すべての描画を消去し、初期状態に戻る
- 記録中に速度・ブラシサイズ・キャンバス長さの変更は不可

---

## 5. 出力

- 白背景 + 描画痕跡
- PNG 形式で書き出す
- **設定したキャンバス長さ全体**を出力（例：5000px設定なら5000px分を書き出し）
- ファイル名：`web-design-rokuro-[timestamp].png`

---

## 6. PC / タブレット両対応の動作仕様

### タブレット
- タッチ操作で描画
- Full Paint Modeボタンをタップして使用
- ブラシプレビューは非対応（PC専用機能）

### PC
- マウス：描画
- **スペースキー**：記録の開始/停止（ボタンのフォーカス不要）
- **Shiftキー**：Full Paint Mode（ボタンのフォーカス不要）
- **ブラシプレビュー**：マウスカーソルがキャンバス上にあると、薄いグレー1px境界線の矩形が表示される

---

## 7. デザイン仕様

### ミニマル/ソリッドなスタイル
- **無彩色の配色**：黒（#333）、白、グレー系のみ
- **シャドウなし**：すべてのドロップシャドウを排除
- **角丸最小限**：2px（ほぼ矩形）
- **細い境界線**：1px solid #333
- **トランジション**：0.15s（短く、機敏に）

### 配色詳細
- **通常ボタン**：白背景 + 黒ボーダー + 黒文字
- **ホバー**：#f5f5f5背景
- **アクティブ/選択**：#333背景 + 白文字
- **記録中ボタン**：#333背景 + 白文字
- **無効化**：opacity 0.4

---

## 8. 技術仕様

### パフォーマンス最適化
- **矩形ブラシ**：fillRectを使用（arcより高速）
- **不透明度100%固定**：透明度合成計算が不要
- **一時キャンバスの再利用**：tempCanvasRefで管理
- **状態更新のスロットリング**：60FPS（16ms間隔）
- **単一レイヤー**：複数レイヤー管理のオーバーヘッドを排除
- **統合アニメーションループ**：スクロール、描画、レンダリングを単一のrequestAnimationFrameループで処理
- **Ref活用**：アニメーションループ内でReact stateの更新遅延を回避

### Canvas処理
- Canvas API使用
- 描画用キャンバスと表示用キャンバスの2層構造
- 仮想キャンバス（高さ：ユーザー設定値 2000px〜10000px）を管理
- スクロールオフセットに応じて可視領域を描画
- ブラシ描画は仮想座標系で実行
- **ループ記録**：スクロールオフセットがキャンバス長さに到達したら0にリセット
- **モジュロ演算**：すべての描画座標に対して`% canvasLength`を適用し、円環的なキャンバスを実現
- **ループ可視化レンダリング**：
  - キャンバス末尾付近では、画面を2分割してレンダリング
  - 上部：キャンバス末尾部分を表示
  - 下部：キャンバス冒頭部分を表示
  - これにより、末尾で描画しても即座に冒頭部分として確認可能

---

## 9. 実装状況

### 実装済み機能
✅ キャンバス + 自動スクロール
✅ 横長矩形ブラシ（8:1）の描画
✅ 連続描画（タッチし続けている間、スクロールに応じて描画）
✅ 記録開始／停止
✅ ブラシプレビューカーソル（PC）
✅ UI配置（ミニマルデザイン）
✅ 設定モーダル（サイズ・速度）
✅ キャンバス長さ設定UI（2000px〜10000px、デフォルト5000px）
✅ ループ記録機能（キャンバス末尾で自動的に冒頭に戻る）
✅ ループ可視化（末尾付近で冒頭部分を画面下部に表示）
✅ Full Paint Mode（Shiftキー対応）
✅ 記録開始/停止（スペースキー対応）
✅ PNG書き出し（設定キャンバス長さ全体）
✅ スクロール位置表示（現在位置/総長さ、ループ回数）

### パフォーマンス改善履歴
✅ 統合アニメーションループによる描画とレンダリングの同期
✅ モジュロ演算による円環的キャンバスの実現
✅ scrollOffsetRef導入によるstate更新遅延の解消
✅ キャンバス末尾での描画が即座に可視化される仕組み

---

## 10. アプリ情報

- **アプリ名**：Web Design Rokuro
- **ページタイトル**：Web Design Rokuro
- **エクスポートファイル名**：`web-design-rokuro-[timestamp].png`

---
